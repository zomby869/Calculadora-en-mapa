<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculador de precio por km</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f4f4f4;color:#222}
    .wrap{max-width:900px;margin:18px auto;padding:18px}
    .card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:8px}
    input[type="text"],button{
      padding:10px;border-radius:8px;border:1px solid #d0d0d0;font-size:15px;flex:1;min-width:180px;
    }
    button{cursor:pointer;background:#0b74de;color:#fff;border:none}
    #map{height:380px;border-radius:10px;margin-top:12px}
    #resultado{margin-top:12px;font-weight:600}
    @media(min-width:900px){
      .controls{display:flex;gap:12px}
      #map{height:480px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2>Calculador de precio por km</h2>
      <div class="row controls">
        <input id="origen" type="text" placeholder="Origen (ej. Calle y Número o barrio)" />
        <input id="destino" type="text" placeholder="Destino" />
      </div>
      <div class="row">
        <button id="btnCalcular">Calcular</button>
      </div>

      <div id="resultado">Ingresá origen y destino y presioná «Calcular».</div>
      <div id="map"></div>
      <small style="display:block;margin-top:8px;color:#666">
        Consejo: usá las sugerencias automáticas al escribir (autocomplete). Si no ves sugerencias o aparece error, mirá la consola del navegador (F12).
      </small>
    </div>
  </div>

  <script>
    // ---------------------------------------------------------
    // VARIABLES Y CONFIGURACIÓN FIJA
    // ---------------------------------------------------------
    let map, directionsService, directionsRenderer, autocompleteOrigen, autocompleteDestino;

    // Valores que solo vos podes cambiar
    const TARIFA_KM = 500;       // Precio por km
    const PRECIO_BAJADA = 1000;   // Precio de bajada inicial

    // ---------------------------------------------------------
    // INICIALIZACIÓN DEL MAPA
    // ---------------------------------------------------------
    function initMap() {
      const centro = { lat: -38.9516, lng: -68.0596 }; // Neuquén aprox.
      map = new google.maps.Map(document.getElementById("map"), { center: centro, zoom: 12, mapTypeControl: false });
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({ map: map, suppressMarkers: false });

      autocompleteOrigen = new google.maps.places.Autocomplete(document.getElementById("origen"), { fields: ["formatted_address", "geometry", "name"] });
      autocompleteDestino = new google.maps.places.Autocomplete(document.getElementById("destino"), { fields: ["formatted_address", "geometry", "name"] });

      document.getElementById("btnCalcular").addEventListener("click", calcular);
    }

    // ---------------------------------------------------------
    // FUNCIÓN DE CÁLCULO
    // ---------------------------------------------------------
    function calcular() {
      const origen = document.getElementById("origen").value.trim();
      const destino = document.getElementById("destino").value.trim();

      if (!origen || !destino) { alert("Ingresá origen y destino."); return; }

      const dms = new google.maps.DistanceMatrixService();
      dms.getDistanceMatrix({
        origins: [origen],
        destinations: [destino],
        travelMode: 'DRIVING',
        unitSystem: google.maps.UnitSystem.METRIC,
        avoidTolls: false
      }, (response, status) => {
        if (status !== 'OK') {
          console.error("DistanceMatrix error:", status, response);
          alert("Error al calcular la distancia: " + status);
          return;
        }

        const element = response.rows[0].elements[0];
        if (element.status !== "OK") {
          alert("No se pudo calcular la distancia: " + element.status);
          return;
        }

        const distanciaKm = element.distance.value / 1000;
        const precioKm = distanciaKm * TARIFA_KM;
        const precioTotal = PRECIO_BAJADA + precioKm;

        // Resultado en tarjeta visual
        document.getElementById("resultado").innerHTML = `
          <div style="
            background:#f0f8ff;
            border-radius:10px;
            padding:12px;
            box-shadow:0 4px 12px rgba(0,0,0,0.1);
            display:flex;
            flex-direction:column;
            gap:6px;
          ">
            <div><strong>Distancia:</strong> ${element.distance.text} (${distanciaKm.toFixed(2)} km)</div>
            <div style="display:flex;justify-content:space-between;">
              <span><strong>Precio de bajada:</strong></span> <span>$${PRECIO_BAJADA.toFixed(2)}</span>
            </div>
            <div style="display:flex;justify-content:space-between;">
              <span><strong>Precio por km:</strong></span> <span>$${precioKm.toFixed(2)}</span>
            </div>
            <hr style="border:none;border-top:1px solid #ccc;">
            <div style="font-size:1.1em;font-weight:700;text-align:right;">Precio total: $${precioTotal.toFixed(2)}</div>
          </div>
        `;

        // Mostramos la ruta en el mapa
        directionsService.route({
          origin: origen,
          destination: destino,
          travelMode: google.maps.TravelMode.DRIVING
        }, (routeResult, routeStatus) => {
          if (routeStatus === 'OK') {
            directionsRenderer.setDirections(routeResult);
          } else {
            console.warn("DirectionsService:", routeStatus);
          }
        });
      });
    }
  </script>

  <!-- CARGA DE LA API: reemplazá TU_API_KEY por tu clave real de Google Cloud -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4BTT3rUnL-gGpHZj05kkcZYmTnzY7BRo&libraries=places&callback=initMap">
  </script>
</body>
</html>


